---
title: "Salmon Escapement Estimate for Akalara River, Kodiak Refuge"
author: "McCrea Cobb"
date: "`r format(Sys.time(), '%d %B, %Y')`"
output: 
  rmarkdown::pdf_document
param: 
  data:
    label: "Input dataset (csv):"
    input: file
---

```{r setup, include=FALSE, cache=FALSE}
library(knitr)
knitr::opts_chunk$set(echo = TRUE)
knitr::read_chunk("../code/akalura.R")
knitr::opts_chunk$set(warning = FALSE)
knitr::opts_chunk$set(message = FALSE)
```


## Overview

### Biometric Request #
BiometricRequest_20180213_2

### Contact
Gareth "Kevin" VanHatten

### Association
Kodiak Refuge

### Preferred means of contact
Email

#### Contact info
kevin_vanhatten@fws.gov  Phone: 907-539-1669

### Date of request
02-13-2018

### Objective
Help in using the raw data to estimate sockeye salmon abundance using statistical package R.

### Project Description
Kevin had salmon count data from still photographs and video footage to capture sockeye salmon movement within Akalura drainage. He wanted to develop a correction factor using the video counts to apply to the photo count data so that he could estimate annual minimum escapement for the river.

\newpage  


### Results
I imported and formatted the raw dataset (data/derived/dat.Rdata). I subsetted the raw dataset to only include observations when video data were available (data/derived/datud.Rdata).I evaluated linear, polynomial linear, segmented, and segmented polynomial models to assess the relationship between video and photo counts (response=video). Using Delta AICc to evaluate the competing model set, I found the most parsimonous model to be the linear model. Model diagnostics indicated normal residuals and constant error variance (homoskedasticity). 
```{r linear_model, echo=F, warning=F, fig.align="left", message=F}
load("../output/models/mod_best.Rdata")

library(knitr)
library(xtable)
library(tidyverse)

mod.best %>%
  summary() %>%
  xtable() %>%
  kable(caption="Summary of the most parsimonious model (the linear model)")
```


```{r boot}
```

Using the top model, I calculated the estimated daily salmon passage, total annual escapement, and daily salmon passage. I calculated bootstrapped 95% CIs to estimate uncertainty around the annual escapement estimate.  `r max(dat$escape, na.rm=T)`
  
```{r plot_boot, echo=F, fig.cap="Mean minimum escapement estimates for Akalura River, Kodiak Island, Alaska. Error bars represent 95% CIs"}
load("../output/tables/results.Rdata")

ggplot(results, aes(x = as.factor(year), y = escapement)) +
  geom_errorbar(data=results, aes(ymin = lower_ci, ymax = upper_ci),
                width = .1) +
  geom_point() +
  labs(x="Year", y = "Est. min. escapement")
```

\newpage  

## Code
```{r, code=readLines("../code/akalura.R"), eval=FALSE}
```

\newpage

## R Session Information
```{r session_info}
sessionInfo()
```

